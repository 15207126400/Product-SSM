<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunwei.product.common.dao.QhzSalonSignDao">

    <!-- 过滤查询结果(主要用于联合查询) -->
    <resultMap type="com.yunwei.product.common.model.QhzSalonSign" id="resultMap">
         <id column="id" property="id" />
         <id column="openid" property="openid" />
         <result column="name" property="name" />  
         <result column="phone" property="phone" />  
         <result column="card" property="card" />  
         <result column="adviser" property="adviser" />  
         <result column="industry" property="industry" />  
         <result column="turnover" property="turnover" />  
         <result column="position" property="position" />  
         <result column="ticket_number" property="ticket_number" />  
         <result column="sgin_time" property="sgin_time" />  
         <result column="meeting_id" property="meeting_id" />  
         <result column="sgin_code" property="sgin_code" />  
         <result column="pay_status" property="pay_status" />  
         <result column="remark" property="remark" />  
    </resultMap>
    
    <sql id="sql">
         id,
         openid,
         name,
         phone,
         card,
         adviser,
         industry,
         turnover,
         position,
         ticket_number,
         sgin_time,
         meeting_id,
         sgin_code,
         pay_status,
         remark
    </sql>
    
    <sql id="insertSql">
    	 openid,
         name,
         phone,
         card,
         adviser,
         industry,
         turnover,
         position,
         ticket_number,
         sgin_time,
         meeting_id,
         sgin_code,
         pay_status,
         remark
    </sql>
    
    <sql id="unionSql">
         ss.id,
         ss.openid,
         ss.name,
         ss.phone,
         ss.card,
         ss.adviser,
         ss.industry,
         ss.turnover,
         ss.position,
         ss.ticket_number,
         ss.sgin_time,
         ss.meeting_id,
         ss.sgin_code,
         ss.pay_status,
         ss.remark
    </sql>
    
    <!-- 当前表参数条件 -->
    <sql id = "whereSql">
	   <where>
            <if test="id != null and id != '' ">
	          and id = #{id}
	        </if>
	        <if test="openid != null and openid != '' ">
	          and openid = #{openid}
	        </if>
            <if test="name != null and name != '' ">
	          and name = #{name}
	        </if>
            <if test="phone != null and phone != '' ">
	          and phone = #{phone}
	        </if>
            <if test="card != null and card != '' ">
	          and card = #{card}
	        </if>
	        <if test="adviser != null and adviser != '' ">
	          and adviser = #{adviser}
	        </if>
	        <if test="industry != null and industry != '' ">
	          and industry = #{industry}
	        </if>
	        <if test="turnover != null and turnover != '' ">
	          and turnover = #{turnover}
	        </if>
	        <if test="position != null and position != '' ">
	          and position = #{position}
	        </if>
	        <if test="ticket_number != null and ticket_number != '' ">
	          and ticket_number = #{ticket_number}
	        </if>
            <if test="sgin_time != null and sgin_time != '' ">
              and DATE_FORMAT(sgin_time,'%Y-%m-%d') = #{sgin_time}
	        </if>
            <if test="meeting_id != null and meeting_id != '' ">
	          and meeting_id = #{meeting_id}
	        </if>
            <if test="sgin_code != null and sgin_code != '' ">
	          and sgin_code = #{sgin_code}
	        </if>
	        <if test="pay_status != null and pay_status != '' ">
	          and pay_status = #{pay_status}
	        </if>
	        <if test="remark != null and remark != '' ">
	          and remark = #{remark}
	        </if>
	    </where> 
    </sql>
    
    <!-- 当前表联合查询条件(Map参数) -->
    <sql id = "whereUnionSql">
	   <where>
            <if test="id != null and id != '' ">
	          and ss.id = #{id}
	        </if>
	        <if test="openid != null and openid != '' ">
	          and ss.openid = #{openid}
	        </if>
            <if test="name != null and name != '' ">
	          and ss.name = #{name}
	        </if>
            <if test="phone != null and phone != '' ">
	          and ss.phone = #{phone}
	        </if>
            <if test="card != null and card != '' ">
	          and ss.card = #{card}
	        </if>
	        <if test="adviser != null and adviser != '' ">
	          and ss.adviser = #{adviser}
	        </if>
	        <if test="industry != null and industry != '' ">
	          and ss.industry = #{industry}
	        </if>
	        <if test="turnover != null and turnover != '' ">
	          and ss.turnover = #{turnover}
	        </if>
	        <if test="position != null and position != '' ">
	          and ss.position = #{position}
	        </if>
	        <if test="ticket_number != null and ticket_number != '' ">
	          and ss.ticket_number = #{ticket_number}
	        </if>
            <if test="sgin_time != null and sgin_time != '' ">
              and DATE_FORMAT(ss.sgin_time,'%Y-%m-%d') = #{sgin_time}
	        </if>
            <if test="meeting_id != null and meeting_id != '' ">
	          and ss.meeting_id = #{meeting_id}
	        </if>
            <if test="sgin_code != null and sgin_code != '' ">
	          and ss.sgin_code = #{sgin_code}
	        </if>
	        <if test="pay_status != null and pay_status != '' ">
	          and ss.pay_status = #{pay_status}
	        </if>
	        <if test="remark != null and remark != '' ">
	          and ss.remark = #{remark}
	        </if>
	    </where> 
    </sql>
    
    <!-- 当前表批量删除条件 -->
    <sql id="whereBatchSql">
		<where>
			<if test="id != null and id != '' ">
				and id in
				<foreach collection="id" item="id" separator="," open="("
					close=")">
					#{id}
				</foreach>
			</if>
		</where>
	</sql>
	
	<!-- 分页sql条件 -->
	<sql id="pageSql">
       <if test="begin == 0 || begin > 0">
             limit #{begin},#{end}
        </if>
    </sql>

	<!-- 当前表添加-->
	<insert id="insert" parameterType="com.yunwei.product.common.model.QhzSalonSign">
		insert into qhz_salon_sign(<include refid="insertSql"/>) 
		values(
				 #{openid},
	             #{name},
	             #{phone},
	             #{card},
	             #{adviser},
	             #{industry},
	             #{turnover},
	             #{position},
	             #{ticket_number},
	             #{sgin_time},
	             #{meeting_id},
	             #{sgin_code},
	             #{pay_status},
	             #{remark}
		     )
	</insert>
	
	<!-- 当前表批量添加 -->
	<insert id="insertBatch" parameterType="java.util.List">
        insert into qhz_salon_sign(<include refid="insertSql"/>)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (
            	 #{openid},
	             #{item.name},
	             #{item.phone},
	             #{item.card},
	             #{item.adviser},
	             #{item.industry},
	             #{item.turnover},
	             #{item.position},
	             #{item.ticket_number},
	             #{item.sgin_time},
	             #{item.meeting_id},
	             #{item.sgin_code},
	             #{item.pay_status},
	             #{item.remark}
	       )
        </foreach>
    </insert>
    
	<!-- 当前表查询 -->
	<select id="queryList" parameterType="java.util.Map" resultType="com.yunwei.product.common.model.QhzSalonSign">
		select <include refid="sql"/> from qhz_salon_sign
		<include refid="whereSql"/>
		order by id desc
	</select>
	
	<!-- 当前表分页查询(Map参数) -->
	<select id="queryListPage" parameterType="java.util.Map" resultType="com.yunwei.product.common.model.QhzSalonSign">
		select <include refid="sql"/> from qhz_salon_sign
		<include refid="whereSql"/>
		order by id desc
		limit #{begin},#{end}
	</select>
	
	<!-- 当前表联合查询(Map参数)(1、子表关联查询，2、不同类型表关联查询) -->
	<select id="queryUnionList" parameterType="java.util.Map" resultMap="resultMap">
		select <include refid="unionSql"/> from qhz_salon_sign as ss
		<include refid="whereUnionSql"/>
		order by ss.id desc
	</select>
	
	<!-- 当前表联合分页查询)(Map参数)(1、子表关联查询，2、不同类型表关联查询) -->
	<select id="queryUnionListPage" parameterType="java.util.Map" resultMap="resultMap">
		select 
			 ss.id,
	         ss.openid,
	         ss.name,
	         ss.phone,
	         ss.card,
	         ss.adviser,
	         ss.industry,
	         ss.turnover,
	         ss.position,
	         ss.ticket_number,
	         ss.sgin_time,
	         ss.meeting_id,
	         ss.sgin_code,
	         ss.pay_status,
	         ss.remark , 
	         qsm.name as meeting_name from qhz_salon_sign as ss
				left join qhz_salon_meeting qsm on ss.meeting_id = qsm.id
		<where>
			<if test="meeting_id != null and meeting_id != '' ">
	          and ss.meeting_id = #{meeting_id}
	        </if>
	        <if test="pay_status != null and pay_status != '' ">
	          and ss.pay_status = #{pay_status}
	        </if>
		</where>
		order by ss.id desc
		<!-- 分页查询，通过begin条件区别 -->
		<include refid="pageSql"/>
	</select>
	
	<!-- 当前表查询总条数 -->
	<select id="queryTotals" parameterType="java.util.Map" resultType="int">
		select count(1) from qhz_salon_sign
		<include refid="whereSql"/>
	</select>
	
	<!-- 当前表更新 -->
	<update id="update" parameterType="java.util.Map">
	    update qhz_salon_sign
	     <trim prefix="set" suffixOverrides=",">
	     	<if test="openid != null and openid != '' ">
	           openid = #{openid},
	        </if>
            <if test="name != null and name != '' ">
	           name = #{name},
	        </if>
            <if test="phone != null and phone != '' ">
	           phone = #{phone},
	        </if>
            <if test="card != null and card != '' ">
	           card = #{card},
	        </if>
	        <if test="adviser != null and adviser != '' ">
	           adviser = #{adviser},
	        </if>
	        <if test="industry != null and industry != '' ">
	           industry = #{industry},
	        </if>
	        <if test="turnover != null and turnover != '' ">
	           turnover = #{turnover},
	        </if>
	        <if test="position != null and position != '' ">
	           position = #{position},
	        </if>
	        <if test="ticket_number != null and ticket_number != '' ">
	           ticket_number = #{ticket_number},
	        </if>
            <if test="sgin_time != null and sgin_time != '' ">
	           sgin_time = #{sgin_time},
	        </if>
            <if test="meeting_id != null and meeting_id != '' ">
	           meeting_id = #{meeting_id},
	        </if>
            <if test="sgin_code != null and sgin_code != '' ">
	           sgin_code = #{sgin_code},
	        </if>
	        <if test="pay_status != null and pay_status != '' ">
	           pay_status = #{pay_status},
	        </if>
	        <if test="remark != null and remark != '' ">
	           remark = #{remark},
	        </if>
	    </trim>
	    <where>
             <if test="id != null and id != '' ">
	           and id = #{id}
	         </if>
	    </where>
	</update>
	
	<!-- 当前表批量更新 -->
	<update id="updateBatch">
	     update qhz_salon_sign
	     <trim prefix="set" suffixOverrides=",">
	        <foreach collection="fields" item="field" separator="end,">
	          ${field} = CASE id
	          <foreach collection="lists" item="item">
	              when #{item.id} then #{item.${field}}
	          </foreach>
	        </foreach>
	     </trim>
	     <where>
	         and id in
	        <foreach collection="lists" item="item" separator="," open="(" close=")">
	             #{item.id}
	        </foreach>
	     </where>
	</update>
	
	<!-- 当前表删除 -->
	<delete id="delete" parameterType="java.util.Map">
	    delete from qhz_salon_sign
	    <where>
            <if test="id != null and id != '' ">
	           and id = #{id}
	        </if>
	    </where>
	</delete>
	
	<!-- 当前批量删除 -->
	<delete id="deleteBatch" parameterType="java.util.Map">
	   delete from qhz_salon_sign
	   <include refid="whereBatchSql"/>
	</delete>
	
</mapper>