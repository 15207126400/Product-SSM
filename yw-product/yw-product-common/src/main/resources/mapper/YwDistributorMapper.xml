<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunwei.product.common.dao.YwDistributorDao">

	<sql id="sql">
		dis_id ,
		dis_name ,
		dis_type ,
		dis_parentid ,
		dis_status ,
		dis_level ,
		dis_receipt_type ,
		dis_receipt_method ,
		dis_receipt_account,
		dis_mobile ,
		dis_qq ,
		dis_wxcode ,
		dis_address ,
		dis_scale ,
		dis_apply_time ,
		dis_audit_begintime,
		dis_audit_endtime ,
		dis_audit_name,
		dis_audit_remark,
		dis_age,
		dis_sex,
		dis_apply_reason
	</sql>

	<sql id="whereSql">
		<where>
			<if test="dis_id != null and dis_id != '' ">
				<!-- like CONCAT(CONCAT('%',#{dis_id}),'%') -->
				and dis_id = #{dis_id}
			</if>
			<if test="dis_parentid != null and dis_parentid != '' ">
				<!-- like CONCAT(CONCAT('%',#{dis_id}),'%') -->
				and dis_parentid = #{dis_parentid}
			</if> 
		</where>
	</sql>
	
	<sql id="whereBatchSql">
		<where>
			<if test="dis_id != null and dis_id != '' ">
				and dis_id in
				<foreach collection="dis_id" item="id" separator="," open="("
					close=")">
					#{id}
				</foreach>
			</if>
		</where>
	</sql>

	<!-- 字典保存 -->
	<insert id="insert" parameterType="com.yunwei.product.common.model.YwDistributor">
		insert into yw_distributor(
		<include refid="sql" />
		)
		values(#{dis_id },
		#{dis_name },
		#{dis_type },
		#{dis_parentid },
		#{dis_status },
		#{dis_level },
		#{dis_receipt_type },
		#{dis_receipt_method },
		#{dis_receipt_account},
		#{dis_mobile },
		#{dis_qq },
		#{dis_wxcode },
		#{dis_address },
		#{dis_scale },
		#{dis_apply_time },
		#{dis_audit_begintime},
		#{dis_audit_endtime },
		#{dis_audit_name },
		#{dis_audit_remark },
		#{dis_age },
		#{dis_sex },
		#{dis_apply_reason }
		)
	</insert>
	
	<!-- 查询表该表与其他表关联信息-->
	<select id="queryUnionMemberList" parameterType="java.util.Map"
		resultType="com.yunwei.product.common.backend.model.dto.YwDistributorDto">
		select
			d.dis_id ,
			d.dis_name ,
			d.dis_type ,
			d.dis_parentid ,
			d.dis_status ,
			d.dis_level ,
			d.dis_receipt_type ,
			d.dis_receipt_method ,
			d.dis_receipt_account,
			d.dis_mobile ,
			d.dis_qq ,
			d.dis_wxcode ,
			d.dis_address ,
			d.dis_scale ,
			d.dis_apply_time ,
			d.dis_audit_begintime,
			d.dis_audit_endtime ,
			d.dis_audit_name,
			d.dis_audit_remark,
			d.dis_age,
			d.dis_sex,
			d.dis_apply_reason,
			m.openid,
			m.nickname,
			p.openid,
			p.nickname as pid_nickname
			
		from yw_distributor d
			left join yw_member m on d.dis_id = m.openid
			left join yw_member p on d.dis_parentid = p.openid
			<where>
				<if test="dis_st_id != null and dis_st_id != '' ">
		          and dis_st_id = #{dis_st_id}
		        </if>
		    </where> 
			order by dis_apply_time desc
			<if test="begin != null and begin != '' ">
				limit #{begin},#{end}
			</if>
	</select>

	<!-- 查询所有字典信息 -->
	<select id="queryList" parameterType="java.util.Map"
		resultType="com.yunwei.product.common.model.YwDistributor">
		select
		<include refid="sql" />
		from yw_distributor
		<include refid="whereSql" />
	</select>

	<!-- 查询分页信息 -->
	<select id="queryListPage" parameterType="java.util.Map"
		resultType="com.yunwei.product.common.model.YwDistributor">
		select
		<include refid="sql" />
		from yw_distributor
		<include refid="whereSql" />
		order by dis_apply_time desc
		limit #{begin},#{end}
	</select>

	<!-- 查询总条数 -->
	<select id="queryTotals" parameterType="java.util.Map"
		resultType="int">
		select count(1) from yw_distributor
		<include refid="whereSql" />
	</select>

	<update id="update" parameterType="java.util.Map">
		update yw_distributor
		<trim prefix="set" suffixOverrides=",">
			<if test="dis_name != null and dis_name != ''">
				dis_name = #{dis_name},
			</if>
			<if test="dis_type != null and dis_type != ''">
				dis_type = #{dis_type},
			</if>
			<if test="dis_parentid != null and dis_parentid != ''">
				dis_parentid = #{dis_parentid},
			</if>
			<if test="dis_status != null and dis_status != ''">
				dis_status = #{dis_status},
			</if>
			<if test="dis_level != null and dis_level != ''">
				dis_level = #{dis_level},
			</if>
			<if test="dis_receipt_type != null and dis_receipt_type != '' ">
				dis_receipt_type = #{dis_receipt_type},
			</if>
			<if test="dis_receipt_method != null and dis_receipt_method != '' ">
				dis_receipt_method = #{dis_receipt_method},
			</if>
			<if test="dis_receipt_account != null and dis_receipt_account != '' ">
				dis_receipt_account = #{dis_receipt_account},
			</if>
			<if test="dis_mobile != null and dis_mobile != '' ">
				dis_mobile = #{dis_mobile},
			</if>
			<if test="dis_qq != null and dis_qq != '' ">
				dis_qq = #{dis_qq},
			</if>
			<if test="dis_wxcode != null and dis_wxcode != '' ">
				dis_wxcode = #{dis_wxcode},
			</if>
			<if test="dis_address != null and dis_address != '' ">
				dis_address = #{dis_address},
			</if>
			<if test="dis_scale != null and dis_scale != '' ">
				dis_scale = #{dis_scale},
			</if>
			<if test="dis_apply_time != null and dis_apply_time != '' ">
				dis_apply_time = #{dis_apply_time},
			</if>
			<if test="dis_audit_begintime != null and dis_audit_begintime != '' ">
				dis_audit_begintime = #{dis_audit_begintime},
			</if>
			<if test="dis_audit_endtime != null and dis_audit_endtime != '' ">
				dis_audit_endtime = #{dis_audit_endtime},
			</if>
			<if test="dis_audit_name != null and dis_audit_name != '' ">
				dis_audit_name = #{dis_audit_name},
			</if>
			<if test="dis_audit_remark != null and dis_audit_remark != '' ">
				dis_audit_remark = #{dis_audit_remark},
			</if>
			<if test="dis_age != null and dis_age != '' ">
				dis_age = #{dis_age},
			</if>
			<if test="dis_sex != null and dis_sex != '' ">
				dis_sex = #{dis_sex},
			</if>
			<if test="dis_apply_reason != null and dis_apply_reason != '' ">
				dis_apply_reason = #{dis_apply_reason},
			</if>
		</trim>
		<where>
		   <if test="dis_id != null and dis_id != '' ">
				<!-- like CONCAT(CONCAT('%',#{dis_id}),'%') -->
				and dis_id = #{dis_id}
			</if>
		</where>
	</update>

	<delete id="delete" parameterType="java.util.Map">
		delete from yw_distributor
		<include refid="whereSql" />
	</delete>
	
	<delete id="deleteBatch" parameterType="java.util.Map">
	   delete from yw_distributor
	   <include refid="whereBatchSql"/>
	</delete>

</mapper>